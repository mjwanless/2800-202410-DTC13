<%- include('templates/header'); %>
<%- include('templates/backBtn'); %>

<div class="bg-orange-50 min-h-screen py-10">
  <div class="container mx-auto px-4">
    <h2 class="text-2xl font-bold mb-5 text-blue-950">Order History</h2>
    <div id="orderHistory" class="space-y-4">
      <!-- Order cards will be rendered here by JavaScript -->
    </div>
    <div class="mt-4 flex justify-between items-center">
      <button onclick="previousPage()" class="bg-gray-500 text-white px-3 py-1 rounded">Previous</button>
      <span>Page <span id="currentPage"></span> of <span id="totalPages"></span></span>
      <button onclick="nextPage()" class="bg-gray-500 text-white px-3 py-1 rounded">Next</button>
    </div>
    <div class="mt-4 flex justify-center items-center">
      <input type="number" id="pageInput" class="border rounded p-2" placeholder="Go to page" min="1" />
      <button onclick="goToPage()" class="bg-blue-500 text-white px-3 py-1 rounded ml-2">Go</button>
    </div>
  </div>
</div>

<%- include('templates/menuBar'); %>
<%- include('templates/footer'); %>

<script>
  let currentPage = 1;
  let totalPages = 1;

  document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    currentPage = parseInt(urlParams.get('page')) || 1;
    loadOrders(currentPage);
  });

  async function loadOrders(page) {
    fetch(`/order_history?page=${page}`)
      .then((response) => response.json())
      .then((data) => {
        const orders = data.orders;
        totalPages = data.totalPages;

        const orderHistoryContainer = document.getElementById('orderHistory');
        orderHistoryContainer.innerHTML = '';

        orders.forEach(order => {
          const orderCard = document.createElement('div');
          orderCard.className = 'bg-orange-50 p-4 rounded-md shadow-md';
          orderCard.innerHTML = `
            <h3 class="text-lg font-bold text-blue-950">Order ID: ${order.orderId}</h3>
            <p class="text-gray-600">Date: ${new Date(order.orderDate).toLocaleDateString()}</p>
            <p class="text-gray-600">Amount: $${order.amount}</p>
          `;
          orderHistoryContainer.appendChild(orderCard);
        });

        document.getElementById('currentPage').textContent = currentPage;
        document.getElementById('totalPages').textContent = totalPages;
        document.getElementById('pageInput').max = totalPages;
      })
      .catch((error) => {
        console.error('Error fetching orders:', error);
      });
  }

  function previousPage() {
    if (currentPage > 1) {
      currentPage--;
      loadOrders(currentPage);
      updateURL();
    }
  }

  function nextPage() {
    if (currentPage < totalPages) {
      currentPage++;
      loadOrders(currentPage);
      updateURL();
    }
  }

  function goToPage() {
    const pageInput = document.getElementById('pageInput').value;
    if (pageInput && pageInput >= 1 && pageInput <= totalPages) {
      currentPage = parseInt(pageInput);
      loadOrders(currentPage);
      updateURL();
    } else {
      alert('Please enter a valid page number.');
    }
  }

  function updateURL() {
    const url = new URL(window.location);
    url.searchParams.set('page', currentPage);
    window.history.pushState({}, '', url);
  }
</script>
